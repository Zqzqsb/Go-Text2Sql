# Text-to-SQL ç³»ç»Ÿå„æ¨¡å—å®æ–½æƒ…å†µ

## 1. å½“å‰å®æ–½çŠ¶æ€æ¦‚è§ˆ

æ ¹æ®é¡¹ç›®ç»“æ„å’Œå®Œæ•´ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼Œä»¥ä¸‹æ˜¯å½“å‰å„æ¨¡å—çš„å®æ–½çŠ¶æ€å›¾ï¼š

```mermaid
graph TD
    %% æ ¸å¿ƒæ¨¡å—
    subgraph å·²å®ç°æ¨¡å—
        A1[Schema Linkingæ¨¡å—] --> |å·²å®ç°| A1_1[SchemaåŠ è½½å™¨]
        A2[Promptæ„é€ æ¨¡å—] --> |å·²å®ç°| A2_1[æç¤ºè¯æ¨¡æ¿]
        A3[LLM Agents] --> |å·²å®ç°| A3_1[å¤šç§LLMæ¥å£]
        A4[DB Adapter] --> |éƒ¨åˆ†å®ç°| A4_1[PostgreSQLé€‚é…]
        A5[æ¾„æ¸…æ¨¡å—] --> |éƒ¨åˆ†å®ç°| A5_1[æ¨¡ç³ŠæŸ¥è¯¢æ£€æµ‹]
        A6[æ‰§è¡ŒéªŒè¯æ¨¡å—] --> |éƒ¨åˆ†å®ç°| A6_1[SQLæ‰§è¡Œå™¨]
    end
    
    subgraph å¾…å®ç°æ¨¡å—
        B1[æ‹’ç­”æ¨¡å—] --> |å¾…å®ç°| B1_1[å†…å®¹è¿‡æ»¤å™¨]
        B1 --> |å¾…å®ç°| B1_2[æ‹’ç»ç­–ç•¥ç®¡ç†å™¨]
        B1 --> |å¾…å®ç°| B1_3[å®‰å…¨æ—¥å¿—è®°å½•å™¨]
        
        B2[æ¾„æ¸…æ¨¡å—å¢å¼º] --> |å¾…å®ç°| B2_1[æ¾„æ¸…é—®é¢˜ç”Ÿæˆå™¨]
        B2 --> |å¾…å®ç°| B2_2[ç”¨æˆ·åé¦ˆæ”¶é›†å™¨]
        
        B3[ä¸šåŠ¡æ£€ç´¢æ¨¡å—] --> |å¾…å®ç°| B3_1[ä¸šåŠ¡çŸ¥è¯†åº“]
        B3 --> |å¾…å®ç°| B3_2[è¯­ä¹‰åŒ¹é…å¼•æ“]
        B3 --> |å¾…å®ç°| B3_3[ä¸šåŠ¡è§„åˆ™è§£é‡Šå™¨]
        
        B4[DB Adapterå¢å¼º] --> |å¾…å®ç°| B4_1[å¤šæ•°æ®åº“æ”¯æŒ]
        B4 --> |å¾…å®ç°| B4_2[SQLæ–¹è¨€è½¬æ¢å™¨]
        
        B5[æ‰§è¡ŒéªŒè¯å¢å¼º] --> |å¾…å®ç°| B5_1[ç»“æœéªŒè¯å™¨]
        B5 --> |å¾…å®ç°| B5_2[è‡ªåŠ¨ä¿®æ­£æœºåˆ¶]
    end
    
    %% è¿æ¥å…³ç³»
    A1 -.-> B3
    A5 -.-> B2
    A4 -.-> B4
    A6 -.-> B5
    
    %% æ ·å¼
    classDef implemented fill:#d4edda,stroke:#28a745,stroke-width:2px;
    classDef partial fill:#fff3cd,stroke:#ffc107,stroke-width:2px;
    classDef pending fill:#f8d7da,stroke:#dc3545,stroke-width:2px;
    
    class A1,A2,A3 implemented;
    class A4,A5,A6 partial;
    class B1,B2,B3,B4,B5 pending;
```

## 2. å·²å®ç°æ¨¡å—è¯¦æƒ…

### 2.1 Schema Linkingæ¨¡å—

**å®ç°ç¨‹åº¦**: âœ… å®Œå…¨å®ç°

**å…³é”®ç»„ä»¶**:
- SchemaåŠ è½½å™¨: æ”¯æŒä»æ•°æ®åº“ä¸­åŠ è½½è¡¨ç»“æ„ã€åˆ—ä¿¡æ¯å’Œå…³ç³»
- å®ä½“è¯†åˆ«ä¸æ˜ å°„: èƒ½å¤Ÿå°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢ä¸­çš„å®ä½“æ˜ å°„åˆ°æ•°æ®åº“schema

**ä»£ç ä½ç½®**: `/home/zq/Projects/GoProjects/GoSql/internal/schema`

### 2.2 Promptæ„é€ æ¨¡å—

**å®ç°ç¨‹åº¦**: âœ… å®Œå…¨å®ç°

**å…³é”®ç»„ä»¶**:
- æç¤ºè¯æ¨¡æ¿: æ”¯æŒå¤šç§æç¤ºè¯æ¨¡æ¿ï¼ŒåŒ…æ‹¬åŸºæœ¬æ¨¡æ¿å’Œå¸¦æ¨ç†è¿‡ç¨‹çš„æ¨¡æ¿
- ä¸Šä¸‹æ–‡æ•´åˆ: å°†schemaä¿¡æ¯å’ŒæŸ¥è¯¢æ•´åˆåˆ°æç¤ºè¯ä¸­

**ä»£ç ä½ç½®**: `/home/zq/Projects/GoProjects/GoSql/cmd/predict/generator.go`

### 2.3 LLM Agents

**å®ç°ç¨‹åº¦**: âœ… å®Œå…¨å®ç°

**å…³é”®ç»„ä»¶**:
- å¤šç§LLMæ¥å£: æ”¯æŒå¤šç§å¤§è¯­è¨€æ¨¡å‹ï¼Œå¦‚OpenAIã€Claudeç­‰
- è¯·æ±‚ç®¡ç†: å¤„ç†å¯¹LLMçš„è¯·æ±‚å’Œå“åº”

**ä»£ç ä½ç½®**: `/home/zq/Projects/GoProjects/GoSql/internal/llm`

### 2.4 DB Adapter

**å®ç°ç¨‹åº¦**: âš ï¸ éƒ¨åˆ†å®ç°

**å…³é”®ç»„ä»¶**:
- PostgreSQLé€‚é…: æ”¯æŒPostgreSQLæ•°æ®åº“çš„è¿æ¥å’ŒæŸ¥è¯¢
- SQLiteæ”¯æŒ: åŸºæœ¬æ”¯æŒSQLiteæ•°æ®åº“

**ä»£ç ä½ç½®**: `/home/zq/Projects/GoProjects/GoSql/internal/database`

**å¾…å®ç°**:
- å¤šæ•°æ®åº“æ”¯æŒ: æ‰©å±•å¯¹æ›´å¤šæ•°æ®åº“ç±»å‹çš„æ”¯æŒ
- SQLæ–¹è¨€è½¬æ¢: åœ¨ä¸åŒæ•°æ®åº“æ–¹è¨€ä¹‹é—´è½¬æ¢SQL

### 2.5 æ¾„æ¸…æ¨¡å—

**å®ç°ç¨‹åº¦**: âš ï¸ éƒ¨åˆ†å®ç°

**å…³é”®ç»„ä»¶**:
- æ¨¡ç³ŠæŸ¥è¯¢æ£€æµ‹: èƒ½å¤Ÿæ£€æµ‹æ¨¡ç³Šæˆ–ä¸æ˜ç¡®çš„æŸ¥è¯¢

**ä»£ç ä½ç½®**: `/home/zq/Projects/GoProjects/GoSql/cmd/predict/generator.go`

**å¾…å®ç°**:
- æ¾„æ¸…é—®é¢˜ç”Ÿæˆ: è‡ªåŠ¨ç”Ÿæˆé’ˆå¯¹æ€§çš„æ¾„æ¸…é—®é¢˜
- ç”¨æˆ·åé¦ˆæ”¶é›†: æ”¶é›†å’Œå¤„ç†ç”¨æˆ·çš„æ¾„æ¸…ä¿¡æ¯

### 2.6 æ‰§è¡ŒéªŒè¯æ¨¡å—

**å®ç°ç¨‹åº¦**: âš ï¸ éƒ¨åˆ†å®ç°

**å…³é”®ç»„ä»¶**:
- SQLæ‰§è¡Œå™¨: èƒ½å¤Ÿæ‰§è¡Œç”Ÿæˆçš„SQLæŸ¥è¯¢

**ä»£ç ä½ç½®**: `/home/zq/Projects/GoProjects/GoSql/internal/database`

**å¾…å®ç°**:
- ç»“æœéªŒè¯: éªŒè¯æŸ¥è¯¢ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ
- è‡ªåŠ¨ä¿®æ­£: åœ¨æŸ¥è¯¢é”™è¯¯æ—¶è‡ªåŠ¨è¯·æ±‚ä¿®æ­£

## 3. å¾…å®ç°æ¨¡å—è¯¦æƒ…

### 3.1 æ‹’ç­”æ¨¡å—

**å®ç°ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å…³é”®ç»„ä»¶**:
- å†…å®¹è¿‡æ»¤å™¨: æ£€æµ‹æŸ¥è¯¢ä¸­çš„æ•æ„Ÿè¯æ±‡å’Œæœ‰å®³å†…å®¹
- æ‹’ç»ç­–ç•¥ç®¡ç†å™¨: å®šä¹‰å¦‚ä½•ä¼˜é›…åœ°æ‹’ç»ä¸é€‚å½“è¯·æ±‚
- å®‰å…¨æ—¥å¿—è®°å½•å™¨: è®°å½•è¢«æ‹’ç»çš„è¯·æ±‚

**å®ç°å»ºè®®**:
- å¯ä»¥åˆ©ç”¨ç°æœ‰LLMçš„å†…å®¹è¿‡æ»¤èƒ½åŠ›
- å»ºç«‹æ•æ„Ÿè¯æ±‡åº“å’Œæ‹’ç»å›ç­”æ¨¡æ¿

### 3.2 ä¸šåŠ¡æ£€ç´¢æ¨¡å—

**å®ç°ä¼˜å…ˆçº§**: ğŸŸ  ä¸­

**å…³é”®ç»„ä»¶**:
- ä¸šåŠ¡çŸ¥è¯†åº“: å­˜å‚¨ä¸šåŠ¡è§„åˆ™ã€æœ¯è¯­å’Œä¸šåŠ¡æµç¨‹
- è¯­ä¹‰åŒ¹é…å¼•æ“: å°†æŸ¥è¯¢ä¸ä¸šåŠ¡æ¦‚å¿µåŒ¹é…
- ä¸šåŠ¡è§„åˆ™è§£é‡Šå™¨: åº”ç”¨ä¸šåŠ¡è§„åˆ™è§£é‡ŠæŸ¥è¯¢

**å®ç°å»ºè®®**:
- æ„å»ºä¸šåŠ¡æœ¯è¯­è¡¨å’Œè§„åˆ™åº“
- ä½¿ç”¨å‘é‡æ•°æ®åº“å­˜å‚¨ä¸šåŠ¡çŸ¥è¯†
- å®ç°RAG(æ£€ç´¢å¢å¼ºç”Ÿæˆ)æœºåˆ¶

## 4. è¿‘æœŸä»»åŠ¡è§„åˆ’

```mermaid
gantt
    title Text-to-SQLç³»ç»Ÿå®æ–½è®¡åˆ’
    dateFormat  YYYY-MM-DD
    section é«˜ä¼˜å…ˆçº§ä»»åŠ¡
    æ‹’ç­”æ¨¡å—åŸºç¡€å®ç°        :a1, 2025-06-05, 7d
    æ¾„æ¸…æ¨¡å—å¢å¼º            :a2, 2025-06-12, 10d
    æ‰§è¡ŒéªŒè¯å¢å¼º            :a3, 2025-06-15, 14d
    
    section ä¸­ä¼˜å…ˆçº§ä»»åŠ¡
    ä¸šåŠ¡æ£€ç´¢æ¨¡å—åŸºç¡€å®ç°    :b1, 2025-06-20, 21d
    DB Adapterå¤šæ•°æ®åº“æ”¯æŒ  :b2, 2025-06-25, 14d
    
    section ä½ä¼˜å…ˆçº§ä»»åŠ¡
    SQLæ–¹è¨€è½¬æ¢å™¨          :c1, 2025-07-10, 14d
    ä¸šåŠ¡è§„åˆ™è§£é‡Šå™¨         :c2, 2025-07-15, 21d
```

## 5. æ¨¡å—é—´äº¤äº’å’Œä¾èµ–å…³ç³»

```mermaid
flowchart TD
    %% ç”¨æˆ·äº¤äº’å±‚
    subgraph ç”¨æˆ·äº¤äº’å±‚[ç”¨æˆ·äº¤äº’å±‚]
        UI[ç”¨æˆ·ç•Œé¢] --> RM[æ‹’ç­”æ¨¡å—]
        UI --> CM[æ¾„æ¸…æ¨¡å—]
        
        %% æ‹’ç­”æ¨¡å—ç»„ä»¶
        subgraph RM_Components[æ‹’ç­”æ¨¡å—ç»„ä»¶]
            RM1[å†…å®¹è¿‡æ»¤å™¨]
            RM2[æ‹’ç»ç­–ç•¥ç®¡ç†å™¨]
            RM3[å®‰å…¨æ—¥å¿—è®°å½•å™¨]
        end
        
        %% æ¾„æ¸…æ¨¡å—ç»„ä»¶
        subgraph CM_Components[æ¾„æ¸…æ¨¡å—ç»„ä»¶]
            CM1[æ¨¡ç³Šæ€§æ£€æµ‹å™¨] --> CM2[æ¾„æ¸…é—®é¢˜ç”Ÿæˆå™¨]
            CM2 --> CM3[ç”¨æˆ·åé¦ˆæ”¶é›†å™¨]
        end
        
        RM --- RM_Components
        CM --- CM_Components
    end
    
    %% ä¸šåŠ¡é€»è¾‘å±‚
    subgraph ä¸šåŠ¡é€»è¾‘å±‚[ä¸šåŠ¡é€»è¾‘å±‚]
        BR[ä¸šåŠ¡æ£€ç´¢æ¨¡å—]
        SL[Schema Linkingæ¨¡å—]
        PC[Promptæ„é€ æ¨¡å—]
        
        %% ä¸šåŠ¡æ£€ç´¢æ¨¡å—ç»„ä»¶
        subgraph BR_Components[ä¸šåŠ¡æ£€ç´¢æ¨¡å—ç»„ä»¶]
            BR1[ä¸šåŠ¡çŸ¥è¯†åº“]
            BR2[è¯­ä¹‰åŒ¹é…å¼•æ“]
            BR3[ä¸šåŠ¡è§„åˆ™è§£é‡Šå™¨]
        end
        
        %% Schema Linkingæ¨¡å—ç»„ä»¶
        subgraph SL_Components[Schema Linkingç»„ä»¶]
            SL1[è¡¨ç»“æ„åŠ è½½å™¨]
            SL2[å®ä½“è¯†åˆ«å™¨]
            SL3[å…³ç³»æ˜ å°„å™¨]
        end
        
        %% Promptæ„é€ æ¨¡å—ç»„ä»¶
        subgraph PC_Components[Promptæ„é€ ç»„ä»¶]
            PC1[åŸºç¡€æç¤ºè¯æ¨¡æ¿]
            PC2[æ¨ç†å¢å¼ºæ¨¡æ¿]
            PC3[ç¤ºä¾‹é€‰æ‹©å™¨]
        end
        
        BR --- BR_Components
        SL --- SL_Components
        PC --- PC_Components
        
        RM --> BR
        CM --> BR
        BR --> SL
        SL --> PC
    end
    
    %% AIå’Œæ•°æ®å±‚
    subgraph AIå’Œæ•°æ®å±‚[AIå’Œæ•°æ®å±‚]
        LA[LLM Agents]
        EV[æ‰§è¡ŒéªŒè¯æ¨¡å—]
        DA[DB Adapter]
        
        %% LLM Agentsç»„ä»¶
        subgraph LA_Components[LLMé€‚é…å™¨]
            LA1[OpenAI APIé€‚é…å™¨]
            LA2[Claude APIé€‚é…å™¨]
            LA3[æœ¬åœ°æ¨¡å‹é€‚é…å™¨]
            LA4[ç™¾åº¦æ–‡å¿ƒé€‚é…å™¨]
        end
        
        %% æ‰§è¡ŒéªŒè¯æ¨¡å—ç»„ä»¶
        subgraph EV_Components[æ‰§è¡ŒéªŒè¯ç»„ä»¶]
            EV1[SQLè§£æå™¨]
            EV2[æŸ¥è¯¢æ‰§è¡Œå™¨]
            EV3[ç»“æœéªŒè¯å™¨]
            EV4[è‡ªåŠ¨ä¿®æ­£æœºåˆ¶]
        end
        
        %% DB Adapterç»„ä»¶
        subgraph DA_Components[æ•°æ®åº“é€‚é…å™¨]
            DA1[PostgreSQLé€‚é…å™¨]
            DA2[MySQLé€‚é…å™¨]
            DA3[SQLiteé€‚é…å™¨]
            DA4[SQLæ–¹è¨€è½¬æ¢å™¨]
        end
        
        LA --- LA_Components
        EV --- EV_Components
        DA --- DA_Components
        
        PC --> LA
        LA --> EV
        EV --> DA
        DA --> DB[(æ•°æ®åº“)]
        EV --> LA
    end
    
    %% å·²å®ç°å’Œå¾…å®ç°æ ‡è®°
    classDef implemented fill:#d4edda,stroke:#28a745,stroke-width:2px;
    classDef partial fill:#fff3cd,stroke:#ffc107,stroke-width:2px;
    classDef pending fill:#f8d7da,stroke:#dc3545,stroke-width:2px;
    
    %% æ¨¡å—å®ç°çŠ¶æ€
    class SL,PC,LA implemented;
    class CM,EV,DA partial;
    class RM,BR pending;
    
    %% ç»„ä»¶å®ç°çŠ¶æ€
    class CM1 implemented;
    class CM2,CM3 pending;
    class BR1,BR2,BR3 pending;
    class SL1,SL2,SL3 implemented;
    class PC1,PC2 implemented;
    class PC3 partial;
    class LA1,LA2 implemented;
    class LA3,LA4 pending;
    class EV1,EV2 partial;
    class EV3,EV4 pending;
    class DA1,DA3 implemented;
    class DA2,DA4 pending;
    class RM1,RM2,RM3 pending;
    
    %% å­å›¾æ ·å¼
    classDef subgraphStyle fill:#f5f5f5,stroke:#ddd,stroke-width:1px;
    class RM_Components,CM_Components,BR_Components,SL_Components,PC_Components,LA_Components,EV_Components,DA_Components subgraphStyle;
```

## 6. æ€»ç»“ä¸ä¸‹ä¸€æ­¥å»ºè®®

å½“å‰Text-to-SQLç³»ç»Ÿå·²ç»å®ç°äº†æ ¸å¿ƒçš„SQLç”ŸæˆåŠŸèƒ½ï¼ŒåŒ…æ‹¬Schema Linkingã€æç¤ºè¯æ„é€ å’ŒLLMäº¤äº’ç­‰å…³é”®æ¨¡å—ã€‚ç³»ç»Ÿèƒ½å¤ŸåŸºäºè‡ªç„¶è¯­è¨€æŸ¥è¯¢å’Œæ•°æ®åº“ç»“æ„ç”ŸæˆSQLè¯­å¥ï¼Œå¹¶æ”¯æŒåŸºæœ¬çš„æ¨¡ç³ŠæŸ¥è¯¢æ£€æµ‹ã€‚

**ä¸‹ä¸€æ­¥ä¼˜å…ˆå®æ–½å»ºè®®**:

1. **æ‹’ç­”æ¨¡å—**: å¢å¼ºç³»ç»Ÿå®‰å…¨æ€§ï¼Œé˜²æ­¢ç”Ÿæˆæœ‰å®³æˆ–æ•æ„Ÿå†…å®¹
2. **æ¾„æ¸…æ¨¡å—å¢å¼º**: æé«˜ç³»ç»Ÿå¤„ç†ä¸æ˜ç¡®æŸ¥è¯¢çš„èƒ½åŠ›ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ
3. **æ‰§è¡ŒéªŒè¯å¢å¼º**: ç¡®ä¿ç”Ÿæˆçš„SQLæ­£ç¡®å¯æ‰§è¡Œï¼Œå¹¶èƒ½è‡ªåŠ¨ä¿®æ­£é”™è¯¯
4. **ä¸šåŠ¡æ£€ç´¢æ¨¡å—**: å¢å¼ºç³»ç»Ÿå¯¹ä¸šåŠ¡ä¸Šä¸‹æ–‡çš„ç†è§£èƒ½åŠ›

è¿™äº›æ”¹è¿›å°†ä½¿ç³»ç»Ÿæ›´åŠ å¥å£®ã€å®‰å…¨ï¼Œå¹¶èƒ½æ›´å¥½åœ°ç†è§£å’Œæ»¡è¶³ç”¨æˆ·çš„æŸ¥è¯¢éœ€æ±‚ã€‚