两条SQL一致性分类规则总结

这个分类规则用于判定用户提交的预测SQL（或称为候选SQL）与标准答案SQL是否“一致”或“等价”。判断的最终结果可以分为两大类：“一致”（等价）或“不一致”（不等价）。在不一致的情况下，会进一步分类具体的不一致原因。

1. 一致 (等价) 的判定：

当预测SQL和标准答案SQL被判定为**等价（Equivalence）**时，则认为这两条SQL是“一致”的。等价的判定主要基于对两条SQL执行后产生的结果集的比较。满足以下任一条件即可判定为等价：

1. sql format 之后完全一致
2. 预测SQL执行产生的结果集与标准答案SQL执行产生的结果集在所有方面都完全相同，包括：行数、列数、列名、列的顺序以及所有单元格的数据内容和行的顺序。
3. 预测SQL执行产生的结果集在语义上与标准答案SQL的结果集等价，即使它们在形式上可能存在特定类型的差异。语义正确的判定规则通常考虑：
允许列位置交换, 在对顺序不铭感的场景中，允许行的位置交换


2. 不一致 (不等价) 的判定及原因分类：

当预测SQL和标准答案SQL未能被判定为等价时，则认为这两条SQL是“不一致”的。不一致的具体原因会被识别并归类，这些原因可以分为两大类，它们的识别阶段和判定逻辑（特别是优先级）有所不同：

A. 执行或初步检查阶段的错误分类 (通过错误信息判断，具有明确的优先级)

这类不一致原因通常是在尝试执行SQL语句、获取结果集的过程中发生的错误，或在执行前的初步检查中发现的问题。这些原因的分类是基于解析错误信息的模式，并按照特定的优先级顺序进行判定。这是由 ClassifyErrorReason 函数实现的逻辑：

优先级 1（最高）：未知的错误 (Unknown Error): 当从执行引擎或系统中获得的原始错误原因字符串为空，或者其内容不匹配任何已知的错误模式时。
优先级 2：参考答案语法错误 (Reference Answer Syntax Error): 当错误原因表明用于对比的标准答案SQL本身存在语法错误或执行失败。
优先级 3：执行错误 (Execution Error): 当错误原因表明用户提交的预测SQL在执行过程中发生错误（例如语法错误、运行时错误等）。
优先级 4：行数错误 (Row Count Error): 当错误原因包含与执行结果“行数”不符相关的提示。
优先级 5：投影错误 (Projection Error): 当错误原因包含与执行结果的“列数”、“列名”不符，或者与查询的“投影”（即选择和组织列的方式）相关的提示。

B. 结果对比阶段的差异 (在成功执行（至少可对比结构）后，通过对比算法发现)

数据不一致 (Data Mismatch)： 在两条SQL的结果集具有相同的行数、列数和匹配的列名（考虑列顺序不敏感）的前提下，结果集中至少有一个单元格的数据内容与标准答案不符。